<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>Chantiers - Gestion des tâches</title>
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body class="app-body">
    <header class="app-header">
      <h1>Gestion des tâches chantiers</h1>
      <div class="user-info">
        Connecté en tant que
        <strong><%= currentUser.prenom %> <%= currentUser.nom %></strong>
        (<%= currentUser.email %>)
        <a href="/logout">Déconnexion</a>
      </div>
    </header>

    <main class="page-shell">
      <% const formatDateFr = date => {
           if (!date) return '';
           const d = new Date(date);
           const day = String(d.getDate()).padStart(2, '0');
           const month = String(d.getMonth() + 1).padStart(2, '0');
           const year = d.getFullYear();
           return `${day}-${month}-${year}`;
         }; %>

      <section class="card">
        <div class="section-heading">
          <h2>Chantiers</h2>
          <a class="btn" href="/import">Importer un fichier Excel de tâches</a>
        </div>
        <% if (!chantiers.length) { %>
          <p class="empty-state">Aucun chantier dans la base.</p>
        <% } else { %>
          <table class="table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Nom</th>
                <th>Créé le</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <% chantiers.forEach(c => { %>
                <tr>
                  <td><%= c.id %></td>
                  <td><%= c.display_name %></td>
                  <td><%= formatDateFr(c.created_at) %></td>
                  <td class="table-actions">
                    <a class="btn btn-link" href="/chantiers/<%= c.id %>/taches">Suivi des tâches</a>
                    <a class="btn btn-link" href="/chantiers/<%= c.id %>/structure">Structure (étages / chambres)</a>
                  </td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        <% } %>
      </section>

      <section class="card">
        <div class="section-heading">
          <h2>Ajouter un chantier</h2>
        </div>
        <form method="post" action="/chantiers" class="add-task-form compact-form">
          <label>Nom du chantier
            <input type="text" name="name" required />
          </label>
          <button type="submit" class="btn">Créer le chantier</button>
        </form>
      </section>
    </main>
  </body>
</html>
